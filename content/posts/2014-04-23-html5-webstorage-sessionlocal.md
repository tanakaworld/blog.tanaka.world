---
title: 【SessionStorage/LocalStorage】ブラウザストレージによる処理速度高速化
slug: html5-webstorage-sessionlocal
date: 2014/04/23 20:04
tags:
- html5
- local-storage
- session-storage
---
<p>HTML5 WebStorageのまとめ．</p><p>WebStorageを使うと，Key-Valueペアで，ブラウザ（ローカル環境）にデータが保存できる．</p><p><!--more--></p><h2 class="page-heading">Cookie vs WebStorage</h2><p>WebStorageはsessionStorage・localStorageの2種類ある．</p><p>以下の特徴がある．</p><p>各ストレージのデータ量上限は，ブラウザによって異なる．<br />下記に詳しく解説されている．</p>- 参考：<a title="" href="http://www.html5rocks.com/ja/tutorials/offline/quota-research/" target="_blank">モダンブラウザのストレージ容量まとめ</a><p>&nbsp;</p><table class="kihon"><tbody><tr class="kihonh"><th> </th><th>別ウィンドウでのデータ共有</th><th>データの有効期限</th></tr><tr style="text-align: center;"><th>クッキー</th><td>○</td><td>指定期限まで有効</td></tr><tr style="text-align: center;"><th>sessionStorage</th><td>×</td><td>ウィンドウやタブを閉じるまで有効</td></tr><tr style="text-align: center;"><th>localStorage</th><td>○</td><td>永続的に有効</td></tr></tbody></table><h2 class="page-heading"><span style="font-size: 16px; line-height: 1.5em;">実装</span></h2><p>localStorageを用いて実装してみた．<br /> cacheHandler.jsでキャッシュを扱う処理を用意．<br /> main.jsで，キャッシュにデータがなければ，取得し，キャッシュに保存する．</p><pre>[code language="javascript" title="cacheHandler.js"]&lt;br /&gt;/**&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * コンストラクタです．&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * @constructor&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; */&lt;br /&gt;function CacheHandler() {&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * HTML5 localStorage からキーに対応するデータを取得します．&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * @param storageKey キー&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * @returns {*} JSON&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; */&lt;br /&gt;CacheHandler.prototype.getCache = function (storageKey) {&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    return angular.fromJson(sessionStorage.getItem(storageKey));&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * HTML5 localStorage にデータを格納します．&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * @param storageKey キー&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * @param data JSON&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; */&lt;br /&gt;CacheHandler.prototype.setCache = function (storageKey, data) {&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    sessionStorage.setItem(storageKey, angular.toJson(data));&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * HTML5 localStorage のデータを削除します．&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; * @param storageKey キー&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt; */&lt;br /&gt;CacheHandler.prototype.removeCache = function (storageKey) {&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    sessionStorage.removeItem(storageKey);&lt;br /&gt;};&lt;br /&gt;[/code]<br /><br />
[code language="javascript" title="main.js"]&lt;br /&gt;// ページ読み込み時に実行したい処理&lt;br /&gt;$().ready(function () {&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    var key = &amp;amp;quot;dataKey&amp;amp;quot;;&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    var cacheHandler = new CacheHandler();&lt;br /&gt;&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    // キャッシュからデータを取得する&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    var data = cacheHandler.getCache(key);&lt;br /&gt;&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    // キャッシュがあればそれを返す&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    if (!data) {&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;        // データを取得する処理&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;        data = &amp;amp;quot;どこかから取得したデータ&amp;amp;quot;;&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;        // キャッシュに格納する&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;        cacheHandler.setCache(key, data);&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    }&lt;br /&gt;&lt;br /&gt;&lt;%%KEEPWHITESPACE%%&gt;    return data;&lt;br /&gt;});&lt;br /&gt;[/code]</pre><br /><br /><p>これだけの実装だとキャッシュが最新状態かどうか判断できないので，<br /> キャッシュ元データが最新版か確認し，そうでなければ再び取得などの処理が必要．</p><p>また，キャッシュの削除処理もどこかに組み込みたい．</p>
